---

- name: Test mirror
  hosts: localhost

  vars:
    sds_pkgs:
      - openio-sds-tools
      - openio-sds-server
      - openio-sds-common
      - openio-sds-common-devel
      - openio-sds-debuginfo
      - openio-sds-swift
      - openio-sds-swift-plugin-swift3

  tasks:

    - name: Information
      debug:
        msg: 'Testing {{ repo_release }} repository on {{ openio_repository_mirror_host }}'

    # Ensure it is not there
    - name: 'Uninstall OpenIO packages'
      package:
        name: '{{ sds_pkgs }}'
        state: absent

    # Ensure nothing remaining can interfere
    - name: Cleanup repository cache
      command: yum clean all
      args:
        warn: 'no'

    # Try to install
    - name: 'Install mirror'
      include_role:
        name: ansible-role-openio-repository
      vars:
        openio_repository_no_log: false
        openio_repository_products:
          sds:
            release: '{{ repo_release }}'

    - name: 'Install OpenIO packages'
      package:
        name: '{{ sds_pkgs }}'
        state: latest

    - name: 'Install OpenIO packages: httpd rawx'
      package:
        name: 'openio-sds-mod-httpd'
        state: latest
      when: repo_release != '19.10'

    # Display installed versions
    - name: 'Check OpenIO packages versions'
      command: 'yum info {{ " ".join(sds_pkgs) }}'
      register: oio_pkg_info        
      args:
        warn: 'no'

    - name: 'Show OpenIO packages versions'
      debug:
        var: oio_pkg_info

...
